#!/bin/bash

# System information
USERNAME=$(whoami)
DATETIME=$(date '+%Y-%m-%d %H:%M:%S')
HOSTNAME=$(hostname)
OS=$(source /etc/os-release && echo $PRETTY_NAME)
UPTIME=$(uptime -p | sed 's/up //')
PROCESSOR=$(lscpu | grep "Model name:" | sed 's/Model name:[ \t]*//')
CPUSPEED=$(lscpu | grep "CPU MHz:" | awk '{print $3 " MHz"}')
CPUSPEED_MAX=$(lscpu | grep "Max MHz:" | awk '{print $4 " MHz"}')
RAM=$(free -h | grep Mem: | awk '{print $2}')
DISKS=$(lsblk -d -o name,size,model | grep 'sd' | awk '{print "- " $3 ", " $2}' | xargs -d '\n' -I{} echo "{}")
VIDEO=$(lspci | grep -i 'vga\|3d\|2d' | cut -d ":" -f3)
FQDN=$(hostname -f)
IPADDRESS=$(hostname -I | awk '{print $1}')
GATEWAY=$(ip route | grep default | awk '{print $3}')
DNSSERVER=$(grep nameserver /etc/resolv.conf | head -n 1 | awk '{print $2}')
NETCARD=$(lspci | grep -i 'Ethernet' | cut -d ":" -f3)
CIDR=$(ip -o -f inet addr show | awk '/scope global/ {print $4}' | head -n 1)
USERLOGGEDIN=$(who | awk '{print $1}' | sort | uniq | tr '\n' ',' | sed 's/,$//')
DISK_SPACE=$(df -h | awk '{if(NR>1)print $6 " " $4}' | xargs -d '\n' -I{} echo "- {}")
PROCESSCOUNT=$(ps -e | wc -l)
LOADAVG=$(cat /proc/loadavg | awk '{print $1", "$2", "$3}')
MEMORYALLOCATION=$(free | grep Mem | awk '{printf("Used: %s, Free: %s", $3, $4)}')
LISTENPORTS=$(ss -tuln | grep LISTEN | wc -l)
UFWRULES=$(sudo ufw status | grep -c '^')

# Output
cat <<EOF

System Report generated by $USERNAME, $DATETIME

System Information
------------------
Hostname: $HOSTNAME
OS: $OS
Uptime: $UPTIME

Hardware Information
--------------------
cpu: $PROCESSOR
Speed: Current: $CPUSPEED, Max: $CPUSPEED_MAX
Ram: $RAM
Disk(s):
$DISKS
Video: $VIDEO

Network Information
-------------------
FQDN: $FQDN
Host Address: $IPADDRESS
Gateway IP: $GATEWAY
DNS Server: $DNSSERVER

InterfaceName: $NETCARD
IP Address: $CIDR

System Status
-------------
Users Logged In: $USERLOGGEDIN
Disk Space:
$DISK_SPACE
Process Count: $PROCESSCOUNT
Load Averages: $LOADAVG
Memory Allocation: $MEMORYALLOCATION
Listening Network Ports: $LISTENPORTS
UFW Rules: $UFWRULES

EOF
